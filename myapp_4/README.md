# Урок 4. Работа с формами

## Теория:

Формы в Django — это инструмент, который позволяет создавать и обрабатывать
HTML-формы. Формы используются для сбора данных от пользователей и отправки
их на сервер для дальнейшей обработки.
Определение формы в Django начинается с создания класса формы, который
наследуется от класса forms.Form. В этом классе определяются поля формы, их
типы, валидация и другие атрибуты. Поля формы могут быть текстовыми,
числовыми, выбором из списка и т.д.
Плюсы использования форм в Django заключаются в том, что они позволяют
упростить процесс сбора данных от пользователей и обработки их на сервере.
Формы автоматически проверяют данные на корректность, что позволяет избежать
ошибок при обработке данных. Кроме того, формы могут быть переиспользованы в
разных частях приложения, что упрощает разработку и поддержку кода.
В целом, использование форм в Django - это удобный и эффективный способ сбора
и обработки данных от пользователей, который позволяет упростить разработку и
поддержку веб-приложений. Однако, при использовании форм необходимо
учитывать их ограничения и принимать меры для защиты от возможных
уязвимостей.

#### Класс формы

В Django для создания форм используются классы,
которые наследуются от класса forms.Form.
Фреймворк Django
from django import forms
class UserForm(forms.Form):
name = forms.CharField(max_length=50)
email = forms.EmailField()
age = forms.IntegerField(min_value=0, max_value=120)

#### Из класса формы в HTML форму

Представление для формы
● Проверка на POST и GET
● Создание объекта формы
● Проверка валидации
● Обработка данных
● Возврат формы
Маршрут для
связи представления
с URL-адресом
Отрисовка шаблона
● Вывод тегов формы
с указанием метода
и адреса
● Вывод csrf-токена
● Вывод элементов формы
● Вывод кнопки “Отправить”

#### Поля и виджеты форм

##### Поля форм

Перечислим некоторые из наиболее популярных классов Field в Django
CharField — используется для создания текстовых полей
EmailField — используется для создания поля электронной почты
IntegerField — используется для создания поля для ввода целых чисел.
FloatField — используется для ввода чисел с плавающей точкой.
BooleanField — используется для создания поля флажка.
DateTimeField — используется для создания поля даты и времени.
FileField — используется для создания поля для загрузки файла.
ImageField — используется для создания поля для загрузки изображения.
ChoiceField — используется для создания выпадающего
списка с выбором одного из нескольких вариантов.

##### Виджеты форм

Для работы с формами используются виджеты,
которые определяют внешний вид и поведение полей формы на странице
TextInput — используется для создания текстового поля ввода.
Textarea — используется для создания многострочного текстового поля ввода.
PasswordInput — используется для создания поля ввода пароля.
NumberInput — используется для создания поля ввода чисел.
CheckboxInput — используется для создания флажка.
DateTimeInput — используется для создания поля ввода даты и времени.
FileInput — используется для создания поля загрузки файла.
Select — используется для создания выпадающего списка с выбором одного из нескольких вариантов.
RadioSelect — используется для создания списка радиокнопок.

#### Обработка данных форм

##### Пользовательская валидация данных с помощью метода clean()

Мы можем прописать свои методы, которые начинаются
со слова clean_ и далее указать имя поля.
class UserForm(forms.Form):
email = forms.EmailField()
...
def clean_email(self):
email = self.cleaned_data['email']
if not (email.endswith('vk.team') or email.endswith('corp.mail.ru')):
raise forms.ValidationError('Используйте корпоративную почту')
return email

#### Сохранение формы в базу данных

...
def add_user(request):
if request.method == 'POST':
form = UserForm(request.POST)
if form.is_valid():
name = form.cleaned_data['name']
email = form.cleaned_data['email']
user = User(name=name, email=email)
user.save()
...
После того как форма заполнена пользователем, отправлена Django,
проверена и прошла валидацию данные можно использовать.
Обычно использование — это сохранение в базу данных

#### Сохранение изображений/файлов

Настройка settings.py
...
MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'
...
Шаблон upload.html
…
<form method="post"
enctype="multipart/form-data">
...
Особенности сохранения изображений / файлов
Представление views.py
...
form = ImageForm(request.POST,
request.FILES)
if form.is_valid():
 image = form.cleaned_data['img']
 fs = FileSystemStorage()
 fs.save(image.name, image)
 ...

#### Создание суперпользователя

python manage.py createsuperuser
python manage.py changepassword <username>
По умолчанию доступ к административной панели имеет только суперпользователь
(superuser). А если забыли пароль, его можно изменить, но не подсмотреть